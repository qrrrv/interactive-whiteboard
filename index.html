<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Интерактивная Доска</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <!-- Верхняя панель -->
  <div class="top-toolbar">
    <div class="toolbar-item" id="collabBtn" data-toggle="modal" data-target="#collabModal"><i class="fas fa-users"></i> Совместный Урок</div>
    <div class="toolbar-item" id="settingsBtn"><i class="fas fa-cog"></i> Настройки</div>
    <div class="toolbar-item" id="rainbowBrushToggle"><i class="fas fa-rainbow"></i> Радужная Кисть</div>
  </div>

  <!-- Панель настроек -->
  <div class="settings-panel" id="settingsPanel">
    <div class="settings-header">
      <h3><i class="fas fa-cog"></i> Настройки</h3>
      <button class="settings-close" id="closeSettings"><i class="fas fa-times"></i></button>
    </div>
    <div class="settings-content">
      <div class="settings-section">
        <h4><i class="fas fa-palette"></i> Темы оформления</h4>
        <div class="theme-grid">
          <div class="theme-option active" data-theme="winter">
            <div class="theme-preview" style="background: linear-gradient(135deg, #a8d8ea, #d0e8f2, #e8f4f8)"></div>
            <span>Зимняя ❄</span>
          </div>
          <div class="theme-option" data-theme="light">
            <div class="theme-preview" style="background: linear-gradient(135deg, #f0f2f5, #e2e8f0)"></div>
            <span>Светлая</span>
          </div>
          <div class="theme-option" data-theme="dark">
            <div class="theme-preview" style="background: linear-gradient(135deg, #1a1a2e, #16213e)"></div>
            <span>Темная</span>
          </div>
          <div class="theme-option" data-theme="ocean">
            <div class="theme-preview" style="background: linear-gradient(135deg, #0f2027, #203a43, #2c5364)"></div>
            <span>Океан</span>
          </div>
          <div class="theme-option" data-theme="sunset">
            <div class="theme-preview" style="background: linear-gradient(135deg, #ff6b6b, #ee5a6f, #c44569)"></div>
            <span>Закат</span>
          </div>
          <div class="theme-option" data-theme="forest">
            <div class="theme-preview" style="background: linear-gradient(135deg, #134e5e, #71b280)"></div>
            <span>Лес</span>
          </div>
          <div class="theme-option" data-theme="purple">
            <div class="theme-preview" style="background: linear-gradient(135deg, #4a00e0, #8e2de2)"></div>
            <span>Фиолетовая</span>
          </div>
        </div>
      </div>
      
      <div class="settings-section">
        <h4><i class="fas fa-sliders-h"></i> Интерфейс</h4>
        <div class="settings-toggle">
          <label>
            <input type="checkbox" id="showCoordinates" checked>
            <span>Показывать координаты курсора</span>
          </label>
        </div>
        <div class="settings-toggle">
          <label>
            <input type="checkbox" id="showStatusBar" checked>
            <span>Показывать строку состояния</span>
          </label>
        </div>
        <div class="settings-toggle">
          <label>
            <input type="checkbox" id="autoSave">
            <span>Автосохранение каждые 5 минут</span>
          </label>
        </div>
        <div class="settings-toggle">
          <label>
            <input type="checkbox" id="snowflakesToggle">
            <span>Показывать снежинки ❄</span>
          </label>
        </div>
      </div>

      <div class="settings-section">
        <h4><i class="fas fa-brush"></i> Рисование</h4>
        <div class="settings-toggle">
          <label>
            <input type="checkbox" id="smoothDrawing" checked>
            <span>Сглаживание линий</span>
          </label>
        </div>
        <div class="settings-toggle">
          <label>
            <input type="checkbox" id="pressureSensitive">
            <span>Чувствительность к нажатию</span>
          </label>
        </div>
      </div>

      <div class="settings-section">
        <h4><i class="fas fa-info-circle"></i> О программе</h4>
        <p style="color: #666; margin: 10px 0;">Интерактивная Доска v2.0</p>
        <p style="color: #888; font-size: 0.9rem;">Многофункциональная доска для рисования и обучения</p>
      </div>
    </div>
  </div>

  <div class="container">
    <h1><i class="fas fa-draw-polygon"></i> Интерактивная Доска</h1>
    
    <!-- Вкладки холстов -->
    <div class="canvas-tabs" id="canvasTabs"></div>

    <!-- Быстрые действия -->
    <div class="tools-section">
      <div class="tool-btn-card" data-toggle="modal" data-target="#calculatorModal"><i class="fas fa-calculator"></i><span>Калькулятор</span></div>
      <div class="tool-btn-card" id="saveCanvasBtn"><i class="fas fa-save"></i><span>Сохранить</span></div>
      <div class="tool-btn-card" id="loadCanvasBtn"><i class="fas fa-folder-open"></i><span>Загрузить</span></div>
      <div class="tool-btn-card" id="newCanvasBtn"><i class="fas fa-plus"></i><span>Новый Холст</span></div>
      <div class="tool-btn-card" id="resizeCanvasBtn"><i class="fas fa-expand-arrows-alt"></i><span>Размер Холста</span></div>
    </div>

    <!-- Контейнер холста -->
    <div class="whiteboard-container">
      <div class="canvas-wrapper" id="canvasWrapper">
        <canvas id="whiteboard"></canvas>
        
        <!-- ПЛАВАЮЩАЯ ПАНЕЛЬ ИНСТРУМЕНТОВ -->
        <div class="floating-toolbar" id="floatingToolbar">
          <!-- Основные инструменты -->
          <div class="toolbar-section">
            <div class="tool-btn active" data-mode="pencil" title="Кисть"><i class="fas fa-paint-brush"></i></div>
            <div class="tool-btn" data-mode="eraser" title="Ластик"><i class="fas fa-eraser"></i></div>
            <div class="tool-btn" data-mode="select" title="Выбор"><i class="fas fa-mouse-pointer"></i></div>
          </div>
          
          <div class="toolbar-divider"></div>
          
          <!-- Фигуры -->
          <div class="toolbar-section">
            <div class="tool-btn" data-mode="line" title="Линия"><i class="fas fa-minus"></i></div>
            <div class="tool-btn" data-mode="rectangle" title="Прямоугольник"><i class="fas fa-square"></i></div>
            <div class="tool-btn" data-mode="circle" title="Круг"><i class="fas fa-circle"></i></div>
            <div class="tool-btn" data-mode="triangle" title="Треугольник"><i class="fas fa-play"></i></div>
            <div class="tool-btn" data-mode="ellipse" title="Эллипс"><i class="far fa-circle"></i></div>
            <div class="tool-btn" data-mode="star" title="Звезда"><i class="fas fa-star"></i></div>
            <div class="tool-btn" data-mode="arrow" title="Стрелка"><i class="fas fa-arrow-right"></i></div>
            <div class="tool-btn" data-mode="text" title="Текст"><i class="fas fa-font"></i></div>
          </div>
          
          <div class="toolbar-divider"></div>
          
          <!-- Цвета -->
          <div class="toolbar-section colors">
            <div class="color-btn active" data-color="#000000" style="background:#000"></div>
            <div class="color-btn" data-color="#ff0000" style="background:#ff0000"></div>
            <div class="color-btn" data-color="#00aa00" style="background:#00aa00"></div>
            <div class="color-btn" data-color="#0000ff" style="background:#0000ff"></div>
            <div class="color-btn" data-color="#ffff00" style="background:#ffff00"></div>
            <div class="color-btn" data-color="#ff00ff" style="background:#ff00ff"></div>
            <div class="color-btn" data-color="#00ffff" style="background:#00ffff"></div>
            <div class="color-btn" data-color="#ffffff" style="background:#fff;border:1px solid #ccc"></div>
            <input type="color" id="colorPicker" value="#000000" title="Свой цвет">
          </div>
          
          <div class="toolbar-divider"></div>
          
          <!-- Размер кисти -->
          <div class="toolbar-section brush">
            <input type="range" id="brushSize" min="1" max="30" value="5">
            <span id="brushSizeValue">5</span>
          </div>
          
          <div class="toolbar-divider"></div>
          
          <!-- Заливка -->
          <div class="toolbar-section">
            <div class="tool-btn" id="fillToggle" title="Заливка фигур"><i class="fas fa-fill-drip"></i></div>
          </div>
          
          <div class="toolbar-divider"></div>
          
          <!-- Действия -->
          <div class="toolbar-section">
            <div class="tool-btn" id="undoBtn" title="Отменить"><i class="fas fa-undo"></i></div>
            <div class="tool-btn" id="redoBtn" title="Вернуть"><i class="fas fa-redo"></i></div>
            <div class="tool-btn" id="clearBtn" title="Очистить"><i class="fas fa-trash"></i></div>
          </div>
          
          <!-- Свернуть -->
          <div class="collapse-btn" id="collapseToolbar" title="Свернуть"><i class="fas fa-chevron-up"></i></div>
        </div>
      </div>
    </div>

    <!-- Статус бар -->
    <div class="status-bar">
      <div id="status">Готов к рисованию</div>
      <div id="coordinates">X: 0, Y: 0</div>
    </div>
  </div>
  
  <!-- Зум -->
  <div class="zoom-panel">
    <button class="zoom-btn" id="zoomOut"><i class="fas fa-minus"></i></button>
    <span id="zoomLevel">100%</span>
    <button class="zoom-btn" id="zoomIn"><i class="fas fa-plus"></i></button>
  </div>

  <!-- КНОПКА ПОЛНОГО ЭКРАНА -->
  <div class="fullscreen-btn" id="fullscreenBtn" title="Полный экран">
    <i class="fas fa-expand"></i>
  </div>

  <!-- ПАНЕЛЬ ДЕЙСТВИЙ В ПОЛНОЭКРАННОМ РЕЖИМЕ -->
  <div class="fullscreen-actions">
    <div class="fullscreen-action-btn save" id="fullscreenSaveBtn" title="Сохранить">
      <i class="fas fa-save"></i>
    </div>
    <div class="fullscreen-action-btn clear" id="fullscreenClearBtn" title="Очистить">
      <i class="fas fa-trash"></i>
    </div>
    <div class="fullscreen-action-btn" id="fullscreenUndoBtn" title="Отменить">
      <i class="fas fa-undo"></i>
    </div>
    <div class="fullscreen-action-btn" id="fullscreenRedoBtn" title="Вернуть">
      <i class="fas fa-redo"></i>
    </div>
  </div>

  <!-- Модалка калькулятора -->
  <div class="modal fade" id="calculatorModal" tabindex="-1">
    <div class="modal-dialog modal-sm">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title"><i class="fas fa-calculator"></i> Калькулятор</h5>
          <button type="button" class="close" data-dismiss="modal"><span>&times;</span></button>
        </div>
        <div class="modal-body">
          <div id="calculator">
            <input type="text" id="calcDisplay" readonly value="0">
            <div class="calc-buttons">
              <button class="calc-btn clear">C</button>
              <button class="calc-btn op">±</button>
              <button class="calc-btn op">%</button>
              <button class="calc-btn op">÷</button>
              <button class="calc-btn num">7</button>
              <button class="calc-btn num">8</button>
              <button class="calc-btn num">9</button>
              <button class="calc-btn op">×</button>
              <button class="calc-btn num">4</button>
              <button class="calc-btn num">5</button>
              <button class="calc-btn num">6</button>
              <button class="calc-btn op">−</button>
              <button class="calc-btn num">1</button>
              <button class="calc-btn num">2</button>
              <button class="calc-btn num">3</button>
              <button class="calc-btn op">+</button>
              <button class="calc-btn num zero">0</button>
              <button class="calc-btn num">.</button>
              <button class="calc-btn equals">=</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Модалка размера холста -->
  <div class="modal fade" id="resizeCanvasModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title"><i class="fas fa-expand-arrows-alt"></i> Изменить размер холста</h5>
          <button type="button" class="close" data-dismiss="modal"><span>&times;</span></button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label>Быстрый выбор:</label>
            <div class="size-presets">
              <button class="preset-btn" data-width="800" data-height="500"><i class="fas fa-desktop"></i> Стандартный<br><small>800×500</small></button>
              <button class="preset-btn" data-width="1200" data-height="600"><i class="fas fa-tv"></i> Широкий<br><small>1200×600</small></button>
              <button class="preset-btn" data-width="1920" data-height="1080"><i class="fas fa-film"></i> Full HD<br><small>1920×1080</small></button>
              <button class="preset-btn" data-width="1000" data-height="1400"><i class="fas fa-mobile-alt"></i> Вертикальный<br><small>1000×1400</small></button>
              <button class="preset-btn" data-width="2000" data-height="2000"><i class="fas fa-square"></i> Квадратный<br><small>2000×2000</small></button>
              <button class="preset-btn" data-width="3000" data-height="1500"><i class="fas fa-panorama"></i> Панорама<br><small>3000×1500</small></button>
            </div>
          </div>
          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label>Ширина (px):</label>
                <input type="number" class="form-control" id="canvasWidth" value="800" min="100" max="5000">
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <label>Высота (px):</label>
                <input type="number" class="form-control" id="canvasHeight" value="500" min="100" max="5000">
              </div>
            </div>
          </div>
          <div class="alert alert-info">
            <i class="fas fa-info-circle"></i> Текущий размер: <span id="currentSize">800×500</span>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Отмена</button>
          <button type="button" class="btn btn-primary" id="applyResize">Применить</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Модалка совместной работы -->
  <div class="modal fade" id="collabModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title"><i class="fas fa-users"></i> Совместный Урок</h5>
          <button type="button" class="close" data-dismiss="modal"><span>&times;</span></button>
        </div>
        <div class="modal-body">
          <div class="row">
            <!-- УЧИТЕЛЬ -->
            <div class="col-md-6">
              <div class="collab-option teacher">
                <div class="collab-icon">
                  <i class="fas fa-chalkboard-teacher"></i>
                </div>
                <h4>Я Учитель</h4>
                <p>Создайте урок и пригласите учеников</p>
                
                <div class="form-group">
                  <label>Название урока:</label>
                  <input type="text" class="form-control" id="roomNameInput" placeholder="Урок рисования">
                </div>
                
                <div class="form-group">
                  <label>Ваше имя:</label>
                  <input type="text" class="form-control" id="teacherNameInput" placeholder="Иван Иванович">
                </div>
                
                <button class="btn btn-primary btn-block" id="startClassBtn">
                  <i class="fas fa-chalkboard-teacher"></i> Создать урок
                </button>
              </div>
            </div>
            
            <!-- УЧЕНИК -->
            <div class="col-md-6">
              <div class="collab-option student">
                <div class="collab-icon">
                  <i class="fas fa-user-graduate"></i>
                </div>
                <h4>Я Ученик</h4>
                <p>Введите код урока от учителя</p>
                
                <div class="form-group">
                  <label>Код урока:</label>
                  <input type="text" class="form-control" id="roomIdInput" placeholder="ABC123" style="text-transform: uppercase;">
                </div>
                
                <div class="form-group">
                  <label>Ваше имя:</label>
                  <input type="text" class="form-control" id="studentNameInput" placeholder="Ваше имя">
                </div>
                
                <button class="btn btn-success btn-block" id="joinClassBtn">
                  <i class="fas fa-user-graduate"></i> Присоединиться
                </button>
              </div>
            </div>
          </div>
          
          <div class="alert alert-info mt-3">
            <i class="fas fa-info-circle"></i> 
            <strong>Внимание:</strong> Для работы необходима настройка Firebase. 
            Инструкция в файле <code>collaboration/README.md</code>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ПАНЕЛЬ ИНФОРМАЦИИ О КОМНАТЕ -->
  <div class="room-info-panel" id="roomInfoPanel" style="display: none;">
    <div class="room-header">
      <div class="room-title">
        <i class="fas fa-broadcast-tower"></i>
        <span id="roomRole">Учитель</span>
      </div>
      <button class="room-close" id="leaveClassBtn" title="Выйти из урока">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <div class="room-body">
      <div class="room-code">
        <label>Код урока:</label>
        <div class="code-display">
          <span id="displayRoomId">ABC123</span>
          <button class="btn btn-sm btn-primary" id="copyRoomIdBtn">
            <i class="fas fa-copy"></i> Копировать код
          </button>
        </div>
      </div>
      
      <div id="teacherControls" style="display: none;">
        <button class="btn btn-warning btn-block mb-2" id="lockCanvasBtn">
          <i class="fas fa-unlock"></i> Заблокировать холст
        </button>
        
        <div class="students-section">
          <h6><i class="fas fa-users"></i> Ученики (<span id="studentCount">0</span>)</h6>
          <div id="studentsList"></div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/4.5.0/fabric.min.js"></script>
  
  <!-- Firebase для совместной работы -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <script src="firebase-config.js"></script>
  
  <!-- Модули совместной работы -->
  <script src="collaboration/collab-client.js"></script>
  <script src="collaboration/collab-ui.js"></script>
  <script src="collaboration/collab-init.js"></script>
  
  <script src="app.js"></script>
  <script src="snowflakes.js"></script>
</body>
</html>